<!doctype html>
<html lang="en" class="dark">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>JSON Formatter & Viewer</title>

    <!-- Performance and Security Meta Tags -->
    <meta http-equiv="X-Content-Type-Options" content="nosniff" />
    <meta http-equiv="X-XSS-Protection" content="1; mode=block" />
    <meta name="referrer" content="strict-origin-when-cross-origin" />
    <meta
      http-equiv="Content-Security-Policy"
      content="
      default-src 'self';
      script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdnjs.cloudflare.com https://cdn.jsdelivr.net https://www.googletagmanager.com https://static.hotjar.com https://script.hotjar.com;
      style-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com https://cdn.jsdelivr.net https://fonts.googleapis.com;
      font-src 'self' https://cdnjs.cloudflare.com https://fonts.gstatic.com https://script.hotjar.com;
      img-src 'self' data: https:;
      connect-src 'self' https://www.google-analytics.com https://region1.google-analytics.com https://analytics.google.com https://*.hotjar.com https://*.hotjar.io wss://*.hotjar.com;
      frame-src 'self' https://vars.hotjar.com;
      worker-src 'self' blob:;
    "
    />

    <!-- Preconnect for External Resources -->
    <link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin />
    <link rel="dns-prefetch" href="https://cdnjs.cloudflare.com" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />

    <!-- Modern Fonts - Non-blocking with preload and font-display:swap -->
    <link
      rel="preload"
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap"
      as="style"
      onload="this.onload=null;this.rel='stylesheet'"
    />
    <noscript>
      <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap"
        rel="stylesheet"
      />
    </noscript>

    <!-- SEO Meta Tags -->
    <meta
      name="description"
      content="Best free online JSON formatter and JSON viewer. Format, validate, and view JSON data with syntax highlighting, tree view visualization, and real-time validation. Perfect tool for developers."
    />
    <meta
      name="keywords"
      content="JSON formatter, JSON viewer, json formatter online, json viewer online, format json, view json, json beautifier, json validator, json parser, json editor, json syntax highlighter, json tree view"
    />
    <meta name="author" content="Andres Duque" />
    <meta name="robots" content="index, follow" />
    <meta name="language" content="en" />

    <!-- Open Graph Meta Tags -->
    <meta property="og:title" content="JSON Formatter & JSON Viewer - Free Online Tool" />
    <meta
      property="og:description"
      content="Best free online JSON formatter and JSON viewer. Format, validate, and view JSON data with syntax highlighting and tree view visualization."
    />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="{{ request.url if request else '' }}" />
    <meta property="og:site_name" content="JSON Formatter & Viewer" />
    <meta property="og:image" content="{{ url_for('static', path='/img/optimized-size-logo.png') }}" />
    <meta property="og:image:alt" content="Online JSON Viewer Logo" />
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="630" />
    <meta property="og:locale" content="en_US" />

    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="JSON Formatter & JSON Viewer - Free Online Tool" />
    <meta
      name="twitter:description"
      content="Best free online JSON formatter and JSON viewer. Format, validate, and view JSON data with syntax highlighting."
    />
    <meta name="twitter:creator" content="@aduquehd" />
    <meta name="twitter:image" content="{{ url_for('static', path='/img/optimized-size-logo.png') }}" />
    <meta name="twitter:image:alt" content="Online JSON Viewer Logo" />

    <!-- Structured Data (JSON-LD) -->
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "WebApplication",
        "name": "JSON Formatter & JSON Viewer - Free Online Tool",
        "description": "Best free online JSON formatter and JSON viewer. Format, validate, and view JSON data with syntax highlighting, tree view visualization, and real-time validation. Perfect tool for developers.",
        "url": "{{ request.url if request else '' }}",
        "applicationCategory": "DeveloperApplication",
        "operatingSystem": "Any",
        "offers": {
          "@type": "Offer",
          "price": "0",
          "priceCurrency": "USD"
        },
        "featureList": [
          "JSON Formatter",
          "JSON Viewer",
          "Syntax Highlighting",
          "Tree View",
          "JSON Validation",
          "Real-time Formatting",
          "Dark Mode Support",
          "Monaco Editor Integration"
        ],
        "keywords": "JSON formatter, JSON viewer, online JSON formatter, online JSON viewer, format JSON, view JSON",
        "author": {
          "@type": "Person",
          "name": "Andres Duque",
          "url": "https://aduquehd.com/"
        },
        "provider": {
          "@type": "Organization",
          "name": "Andres Duque",
          "url": "https://aduquehd.com/"
        },
        "aggregateRating": {
          "@type": "AggregateRating",
          "ratingValue": "4.8",
          "ratingCount": "1250"
        }
      }
    </script>

    <!-- Favicons and Icons -->
    <link rel="icon" href="{{ url_for('static', path='/img/logo-favicon.png') }}" type="image/png" />
    <link rel="apple-touch-icon" sizes="180x180" href="{{ url_for('static', path='/img/optimized-size-logo.png') }}" />
    <link rel="icon" type="image/png" sizes="32x32" href="{{ url_for('static', path='/img/logo-favicon.png') }}" />
    <link rel="icon" type="image/png" sizes="16x16" href="{{ url_for('static', path='/img/logo-favicon.png') }}" />

    <!-- Additional SEO Tags -->
    <meta name="theme-color" content="#2563eb" />
    <meta name="msapplication-TileColor" content="#2563eb" />
    <link rel="canonical" href="{{ request.url if request else '' }}" />

    <!-- Inline Critical CSS for above-the-fold content to eliminate render-blocking -->
    <style>
      /* Critical CSS inlined for performance */
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }
      :root {
        --bg-primary: #fafafa;
        --bg-secondary: #f5f5f5;
        --text-primary: #1a1a1a;
        --text-secondary: #666;
        --border-color: #e0e0e0;
        --navbar-bg: #fff;
        --navbar-border: #e0e0e0;
        --navbar-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
      }
      [data-theme="dark"] {
        --bg-primary: #1a1a1a;
        --bg-secondary: #2d2d2d;
        --text-primary: #fff;
        --text-secondary: #b0b0b0;
        --border-color: hsla(0, 0%, 100%, 0.1);
        --navbar-bg: linear-gradient(135deg, hsla(0, 0%, 9%, 0.98), rgba(31, 31, 31, 0.98));
      }
      .dark {
        background-color: #1a1a1a;
        color: #e0e0e0;
      }
      body {
        background: var(--bg-primary);
        color: var(--text-primary);
        font-family:
          -apple-system,
          BlinkMacSystemFont,
          Segoe UI,
          Roboto,
          Helvetica Neue,
          Arial,
          sans-serif;
        min-height: 100vh;
        overflow-x: hidden;
      }
      .navbar {
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        background: var(--navbar-bg);
        border-bottom: 1px solid var(--border-color);
        position: sticky;
        top: 0;
        z-index: 1000;
      }
      .navbar-content {
        align-items: center;
        display: flex;
        justify-content: space-between;
        margin: 0 auto;
        max-width: 1400px;
        padding: 1rem 2rem;
      }
      .navbar-title {
        font-size: 1.5rem;
        font-weight: 700;
        line-height: 1.3;
      }
      .highlight {
        background: linear-gradient(135deg, #007bff, #0056b3);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }
      .btn,
      .output-section,
      .tabs {
        opacity: 1;
      }
      .skip-link {
        background: var(--bg-primary);
        border-radius: 0 0 4px 0;
        color: var(--text-primary);
        left: 0;
        padding: 8px 16px;
        position: absolute;
        text-decoration: none;
        top: -40px;
        z-index: 10000;
      }
      .skip-link:focus {
        top: 0;
      }
    </style>

    <!-- Immediate theme initialization script -->
    <script>
      // Run immediately to set theme before page renders
      (function () {
        const savedTheme = localStorage.getItem("theme");
        const isDarkTheme = savedTheme !== null ? savedTheme === "dark" : true;
        if (!isDarkTheme) {
          document.documentElement.classList.remove("dark");
        }
        document.documentElement.setAttribute("data-theme", isDarkTheme ? "dark" : "light");
      })();
    </script>
    <!-- Preload critical CSS -->
    <link rel="preload" href="{{ url_for('static', path='/css/styles.css') }}?v={{ version }}" as="style" />

    <!-- Preload only essential JavaScript modules for initial JSON formatting -->
    <link rel="modulepreload" href="{{ url_for('static', path='/js/app.js') }}?v={{ version }}" />
    <link rel="modulepreload" href="{{ url_for('static', path='/js/utils/theme-utils.js') }}?v={{ version }}" />
    <link rel="modulepreload" href="{{ url_for('static', path='/js/utils/monaco-utils.js') }}?v={{ version }}" />
    <link rel="modulepreload" href="{{ url_for('static', path='/js/utils/json-utils.js') }}?v={{ version }}" />
    <link rel="modulepreload" href="{{ url_for('static', path='/js/utils/clipboard-utils.js') }}?v={{ version }}" />
    <link rel="modulepreload" href="{{ url_for('static', path='/js/utils/view-utils.js') }}?v={{ version }}" />

    <!-- Non-essential modules will be lazy-loaded when needed:
       tree-utils.js, graph-utils.js, diff-utils.js, stats-utils.js,
       chart-utils.js, search-utils.js -->

    <!-- Load CSS synchronously to prevent rendering issues -->
    <link rel="stylesheet" href="{{ url_for('static', path='/css/styles.css') }}?v={{ version }}" />
    <!-- Notyf CSS - Non-blocking for notifications -->
    <link
      rel="preload"
      href="https://cdn.jsdelivr.net/npm/notyf@3/notyf.min.css"
      as="style"
      onload="this.onload=null;this.rel='stylesheet'"
    />
    <noscript>
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/notyf@3/notyf.min.css" />
    </noscript>

    {% if ga_tracking_id %}
    <!-- Google tag (gtag.js) - lazy loaded after page load -->
    <script>
      window.addEventListener("load", function () {
        // Initialize dataLayer early to queue events
        window.dataLayer = window.dataLayer || [];
        window.gtag = function () {
          dataLayer.push(arguments);
        };

        // Load the Google Tag Manager script
        const script = document.createElement("script");
        script.async = true;
        script.src = "https://www.googletagmanager.com/gtag/js?id={{ ga_tracking_id }}";
        script.onload = function () {
          // Configure gtag after script loads
          gtag("js", new Date());
          gtag("config", "{{ ga_tracking_id }}");
        };
        document.head.appendChild(script);
      });
    </script>
    {% endif %}

    <!-- Hotjar Tracking Code for jsonviewer.me (loaded async after page load) -->
    <script>
      window.addEventListener("load", function () {
        (function (h, o, t, j, a, r) {
          h.hj =
            h.hj ||
            function () {
              (h.hj.q = h.hj.q || []).push(arguments);
            };
          h._hjSettings = { hjid: 6481340, hjsv: 6 };
          a = o.getElementsByTagName("head")[0];
          r = o.createElement("script");
          r.async = 1;
          r.src = t + h._hjSettings.hjid + j + h._hjSettings.hjsv;
          a.appendChild(r);
        })(window, document, "https://static.hotjar.com/c/hotjar-", ".js?sv=");
      });
    </script>
  </head>
  <body>
    <!-- Skip to main content link for accessibility -->
    <a href="#main-content" class="skip-link">Skip to main content</a>
    <nav class="navbar">
      <div class="navbar-content">
        <div class="navbar-left">
          <h1 class="navbar-title">
            Online Json
            <span class="highlight">Formatter</span>
            and
            <span class="highlight">Viewer</span>
          </h1>
          <p class="navbar-description">
            Free, open source, and secure. All JSON content is processed locally in your browser—no data is sent to any
            servers.
          </p>
        </div>
        <div class="mobile-navbar-actions">
          <a
            href="https://github.com/aduquehd/json-viewer"
            target="_blank"
            rel="noopener noreferrer"
            class="mobile-github-link"
            title="Open Source"
          >
            <svg class="github-icon" viewBox="0 0 24 24" fill="currentColor">
              <path
                d="M12 0C5.374 0 0 5.373 0 12 0 17.302 3.438 21.8 8.207 23.387c.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23A11.509 11.509 0 0112 5.803c1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576C20.566 21.797 24 17.3 24 12c0-6.627-5.373-12-12-12z"
              />
            </svg>
            <span class="mobile-github-text">Open Source</span>
          </a>
          <button id="mobileThemeBtn" class="mobile-theme-btn" aria-label="Toggle theme">
            <svg
              class="btn-icon theme-icon sun-icon"
              width="20"
              height="20"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <circle cx="12" cy="12" r="5"></circle>
              <line x1="12" y1="1" x2="12" y2="3"></line>
              <line x1="12" y1="21" x2="12" y2="23"></line>
              <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
              <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
              <line x1="1" y1="12" x2="3" y2="12"></line>
              <line x1="21" y1="12" x2="23" y2="12"></line>
              <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
              <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
            </svg>
            <svg
              class="btn-icon theme-icon moon-icon"
              width="20"
              height="20"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
            </svg>
          </button>
        </div>
        <div class="navbar-links">
          <a
            href="https://aduquehd.com/"
            target="_blank"
            rel="noopener noreferrer"
            class="creator-link"
            title="Visit creator's website"
          >
            <svg
              class="link-icon"
              width="16"
              height="16"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>
              <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
            </svg>
            <span>Created by @aduquehd</span>
          </a>
          <a
            href="https://github.com/aduquehd/json-viewer"
            target="_blank"
            rel="noopener noreferrer"
            class="github-link"
            title="View on GitHub"
          >
            <svg class="github-icon" viewBox="0 0 24 24" fill="currentColor">
              <path
                d="M12 0C5.374 0 0 5.373 0 12 0 17.302 3.438 21.8 8.207 23.387c.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23A11.509 11.509 0 0112 5.803c1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576C20.566 21.797 24 17.3 24 12c0-6.627-5.373-12-12-12z"
              />
            </svg>
            <span class="github-text">Open Source</span>
          </a>
        </div>
      </div>
    </nav>
    <div class="container">
      <main id="main-content">
        <div class="top-section">
          <div class="button-group">
            <button id="formatBtn" class="btn btn-primary" aria-label="Format JSON">
              <svg
                class="btn-icon"
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <polyline points="16,18 22,12 16,6"></polyline>
                <polyline points="8,6 2,12 8,18"></polyline>
              </svg>
              Format JSON
            </button>
            <button id="compactBtn" class="btn btn-accent" aria-label="Compact JSON">
              <svg
                class="btn-icon"
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <polyline points="4,14 10,14 10,20"></polyline>
                <polyline points="20,10 14,10 14,4"></polyline>
                <line x1="14" y1="10" x2="21" y2="3"></line>
                <line x1="3" y1="21" x2="10" y2="14"></line>
              </svg>
              Compact JSON
            </button>
            <button id="copyBtn" class="btn btn-secondary" aria-label="Copy JSON">
              <svg
                class="btn-icon"
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
              </svg>
              Copy
            </button>
            <button id="pasteBtn" class="btn btn-secondary" aria-label="Paste JSON">
              <svg
                class="btn-icon"
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path>
                <rect x="8" y="2" width="8" height="4" rx="1" ry="1"></rect>
              </svg>
              Paste
            </button>
            <button id="clearBtn" class="btn btn-secondary" aria-label="Clear editor">
              <svg
                class="btn-icon"
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <polyline points="3,6 5,6 21,6"></polyline>
                <path d="m19,6v14a2,2 0 0,1 -2,2H7a2,2 0 0,1 -2,-2V6m3,0V4a2,2 0 0,1 2,-2h4a2,2 0 0,1 2,2v2"></path>
                <line x1="10" y1="11" x2="10" y2="17"></line>
                <line x1="14" y1="11" x2="14" y2="17"></line>
              </svg>
              Clear
            </button>
          </div>
          <!-- JSON Example Button -->
          <button id="jsonExampleBtn" class="json-example-btn" aria-label="Use JSON examples">
            <svg
              class="json-example-icon"
              width="16"
              height="16"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
              <polyline points="14 2 14 8 20 8"></polyline>
              <line x1="12" y1="13" x2="12" y2="17"></line>
              <polyline points="10 15 12 13 14 15"></polyline>
            </svg>
            <span class="json-example-text">Use an example JSON</span>
          </button>
          <button id="themeBtn" class="btn btn-secondary theme-toggle-btn" aria-label="Toggle theme">
            <svg
              class="btn-icon theme-icon sun-icon"
              width="16"
              height="16"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <circle cx="12" cy="12" r="5"></circle>
              <line x1="12" y1="1" x2="12" y2="3"></line>
              <line x1="12" y1="21" x2="12" y2="23"></line>
              <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
              <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
              <line x1="1" y1="12" x2="3" y2="12"></line>
              <line x1="21" y1="12" x2="23" y2="12"></line>
              <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
              <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
            </svg>
            <svg
              class="btn-icon theme-icon moon-icon"
              width="16"
              height="16"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
            </svg>
            <span class="theme-text">Theme</span>
          </button>
        </div>

        <div class="tabs" role="tablist">
          <button
            class="tab-btn active"
            data-tab="formatted"
            role="tab"
            aria-selected="true"
            aria-controls="formatted-tab"
          >
            JSON Editor
          </button>
          <button class="tab-btn" data-tab="tree" role="tab" aria-selected="false" aria-controls="tree-tab">
            Tree View
          </button>
          <button class="tab-btn" data-tab="graph" role="tab" aria-selected="false" aria-controls="graph-tab">
            Graph View
            <span class="beta-badge">Beta</span>
          </button>
          <button class="tab-btn" data-tab="stats" role="tab" aria-selected="false" aria-controls="stats-tab">
            Statistics
          </button>
          <div class="tab-separator"></div>
          <button class="tab-btn" data-tab="diff" role="tab" aria-selected="false" aria-controls="diff-tab">
            Diff View
          </button>
          <button class="tab-btn" data-tab="chart" role="tab" aria-selected="false" aria-controls="chart-tab">
            Charts
            <span class="beta-badge">Beta</span>
          </button>
          <button class="tab-btn" data-tab="search" role="tab" aria-selected="false" aria-controls="search-tab">
            Search & Filter
          </button>
          <!-- Map View Tab (temporarily disabled - uncomment to re-enable) -->
          <button class="tab-btn" data-tab="map" role="tab" aria-selected="false" aria-controls="map-tab">
            Map View
            <span class="beta-badge">Beta</span>
          </button>
        </div>

        <div class="output-section">
          <div id="formatted-tab" class="tab-content active" role="tabpanel" aria-labelledby="formatBtn">
            <div id="monaco-editor" class="monaco-editor-container">
              <div class="monaco-editor-loading">Loading editor...</div>
            </div>
          </div>
          <div id="tree-tab" class="tab-content" role="tabpanel" aria-labelledby="treeBtn">
            <div class="tree-controls">
              <div class="tree-controls-left">
                <div class="edit-hint" id="treeEditHint" style="display: flex">
                  <span class="edit-icon">✏️</span>
                  <span class="edit-text">Click on any value or key to edit directly</span>
                </div>
                <div class="tree-buttons">
                  <button id="expandAllBtn" class="tree-control-btn" aria-label="Expand all tree nodes">
                    <span class="btn-icon">⊞</span>
                    Expand All
                  </button>
                  <button id="collapseAllBtn" class="tree-control-btn" aria-label="Collapse all tree nodes">
                    <span class="btn-icon">⊟</span>
                    Collapse All
                  </button>
                </div>
              </div>
            </div>
            <div id="treeOutput" class="tree-output"></div>
          </div>
          <div id="graph-tab" class="tab-content" role="tabpanel" aria-labelledby="graphBtn">
            <div id="graphOutput" class="graph-output"></div>
          </div>
          <div id="diff-tab" class="tab-content" role="tabpanel" aria-labelledby="diffBtn">
            <div id="diffOutput" class="diff-output"></div>
          </div>
          <div id="stats-tab" class="tab-content" role="tabpanel" aria-labelledby="statsBtn">
            <div id="statsOutput" class="stats-output"></div>
          </div>
          <!-- Map View Content (temporarily disabled - uncomment to re-enable) -->
          <div id="map-tab" class="tab-content">
            <div id="mapOutput" class="map-output"></div>
          </div>
          <div id="chart-tab" class="tab-content" role="tabpanel" aria-labelledby="chartBtn">
            <div id="chartOutput" class="chart-output"></div>
          </div>
          <div id="search-tab" class="tab-content" role="tabpanel" aria-labelledby="searchBtn">
            <div id="searchOutput" class="search-output"></div>
          </div>
        </div>
      </main>
    </div>

    <!-- JSON Example Modal -->
    <div id="jsonExampleModal" class="json-example-modal" style="display: none">
      <div class="json-example-modal-content">
        <div class="json-example-modal-header">
          <h2 class="json-example-modal-title">Choose a JSON Example</h2>
          <button class="json-example-modal-close" aria-label="Close modal">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="18" y1="6" x2="6" y2="18"></line>
              <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
          </button>
        </div>
        <div class="json-example-modal-body">
          <div class="json-example-grid">
            <!-- E-commerce Product Catalog Example -->
            <div class="json-example-card" data-example="ecommerce">
              <div class="json-example-card-header">
                <svg
                  class="json-example-card-icon"
                  width="24"
                  height="24"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <circle cx="9" cy="21" r="1"></circle>
                  <circle cx="20" cy="21" r="1"></circle>
                  <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
                </svg>
                <h3 class="json-example-card-title">E-commerce Catalog</h3>
              </div>
              <div class="json-example-preview">
                <pre class="json-example-code">
{
  "████████": [
    {
      "██": "██████████",
      "████": "████████████",
      "█████": ███.██,
      "████████": { ███ },
      "██████": [████, ████]
    },
    { ███████████████ }
  ],
  "██████████": [███████],
  "████████": {
    "█████": "████-██-██",
    "███████": ████
  }
}</pre
                >
              </div>
              <button class="json-example-use-btn">Use this example</button>
            </div>

            <!-- Company Financial Sales Data Example -->
            <div class="json-example-card" data-example="financial">
              <div class="json-example-card-header">
                <svg
                  class="json-example-card-icon"
                  width="24"
                  height="24"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <line x1="12" y1="1" x2="12" y2="23"></line>
                  <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
                </svg>
                <h3 class="json-example-card-title">Financial Sales</h3>
              </div>
              <div class="json-example-preview">
                <pre class="json-example-code">
{
  "███████": "████ ███████████",
  "████████████": ████,
  "████████": [
    {
      "███████": ███████,
      "██████": ██████,
      "████████████": █.███
    },
    { ███████████████ }
  ],
  "██████████████": {
    "█████████████": ████████,
    "████████": █.███
  }
}</pre
                >
              </div>
              <button class="json-example-use-btn">Use this example</button>
            </div>

            <!-- Application Configuration Settings Example -->
            <div class="json-example-card" data-example="configuration">
              <div class="json-example-card-header">
                <svg
                  class="json-example-card-icon"
                  width="24"
                  height="24"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <circle cx="12" cy="12" r="3"></circle>
                  <path
                    d="M12 1v6m0 6v6m11-7h-6m-6 0H1m20.485-6.515l-4.242 4.243m-8.485 8.485l-4.243 4.243m0-13.456l4.243 4.242m8.485 8.485l4.242 4.242"
                  ></path>
                </svg>
                <h3 class="json-example-card-title">Application Configuration</h3>
              </div>
              <div class="json-example-preview">
                <pre class="json-example-code">
{
  "███": {
    "████": "████████████",
    "███████": "█.█.█",
    "███████████": "██████████",
    "████████": {
      "█████": █████,
      "████████": "████"
    }
  },
  "██████": {
    "████": "███.██████.███",
    "████": ████,
    "████████": "█████████"
  },
  "████████": [ ███████ ]
}</pre
                >
              </div>
              <button class="json-example-use-btn">Use this example</button>
            </div>

            <!-- Geographic Data - World Cities GeoJSON Example -->
            <div class="json-example-card" data-example="geographic">
              <div class="json-example-card-header">
                <svg
                  class="json-example-card-icon"
                  width="24"
                  height="24"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <circle cx="12" cy="12" r="10"></circle>
                  <line x1="2" y1="12" x2="22" y2="12"></line>
                  <path
                    d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"
                  ></path>
                </svg>
                <h3 class="json-example-card-title">Geographic Data</h3>
              </div>
              <div class="json-example-preview">
                <pre class="json-example-code">
{
  "████": "██████████████████",
  "████████": [
    {
      "████": "███████",
      "████████": {
        "████": "█████",
        "███████████": [██.████, ██.████]
      },
      "██████████": {
        "████": "███ ████",
        "███████": "██████ ██████"
      }
    },
    { ███████████████ }
  ],
  "████": [████, ███, ███, ███]
}</pre
                >
              </div>
              <button class="json-example-use-btn">Use this example</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Load JavaScript libraries with defer to prevent render blocking -->
    <script defer src="https://cdn.jsdelivr.net/npm/notyf@3/notyf.min.js"></script>
    <!-- Load modal handler separately for better code organization -->
    <script type="module" src="{{ url_for('static', path='/js/modal-loader.js') }}?v={{ version }}"></script>

    <!-- Main app loader -->
    <script>
      (function () {
        const loadApp = async () => {
          try {
            // Wait for all libraries to be loaded
            let attempts = 0;
            const maxAttempts = 100; // 10 seconds max

            while (attempts < maxAttempts) {
              const librariesReady = window.Notyf;

              if (librariesReady) {
                // Initialize Notyf globally before loading the app
                if (window.Notyf) {
                  window.notyf = new window.Notyf({
                    duration: 5000,
                    position: {
                      x: "right",
                      y: "top",
                    },
                    types: [
                      {
                        type: "success",
                        background: "green",
                      },
                      {
                        type: "error",
                        background: "indianred",
                      },
                      {
                        type: "warning",
                        background: "orange",
                        icon: {
                          className: "material-icons",
                          tagName: "i",
                          text: "warning",
                        },
                      },
                      {
                        type: "info",
                        background: "#3498db",
                        icon: {
                          className: "material-icons",
                          tagName: "i",
                          text: "info",
                        },
                      },
                    ],
                  });
                }

                // Load the main app module
                const script = document.createElement("script");
                script.type = "module";
                script.src = '{{ url_for("static", path="/js/app.js") }}?v={{ version }}';
                document.body.appendChild(script);
                break;
              }

              attempts++;
              await new Promise((resolve) => setTimeout(resolve, 100));
            }

            if (attempts >= maxAttempts) {
              throw new Error("Failed to load required libraries");
            }
          } catch (error) {
            console.error("Error loading application:", error);
            // Show user-friendly error message
            document.getElementById("main-content").innerHTML =
              '<div style="text-align: center; padding: 2rem;">' +
              "<h2>Error Loading Application</h2>" +
              "<p>Please refresh the page or check your internet connection.</p>" +
              "</div>";
          }
        };

        // Start loading when DOM is ready
        if (document.readyState === "loading") {
          document.addEventListener("DOMContentLoaded", loadApp);
        } else {
          loadApp();
        }
      })();
    </script>
  </body>
</html>
